<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User CRUD</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 5px; }
    .user-card { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
<h1>User CRUD (v1)</h1>

<h3>Create User</h3>
<input id="name" placeholder="Name">
<input id="email" placeholder="Email">
<button onclick="createUser()">Create</button>

<h3>Search Users</h3>
<input id="searchKeyword" placeholder="Enter keyword">
<button onclick="searchUsers()">Search</button>
<button onclick="getAllUsers()">Clear Search</button>

<h3>All Users</h3>
<button onclick="getAllUsers()">Refresh List</button>
<div id="users"></div>

<script>
  const API = 'http://localhost:8080/v1/users';

  async function createUser() {
    const username = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const res = await fetch(API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, email })
    });
    if (res.ok) getAllUsers();
  }

  async function getAllUsers() {
    const res = await fetch(API);
    const users = await res.json();
    renderUsers(users);
  }

  async function searchUsers() {
    const keyword = document.getElementById('searchKeyword').value;
    if (!keyword.trim()) {
      alert('Please enter a keyword to search.');
      return;
    }
    const res = await fetch(`${API}/search?keyword=${encodeURIComponent(keyword)}`);
    const users = await res.json();
    renderUsers(users);
  }

  function renderUsers(users) {
    const usersDiv = document.getElementById('users');
    usersDiv.innerHTML = '';
    users.forEach(user => {
      const div = document.createElement('div');
      div.className = 'user-card';
      div.innerHTML = `
        <b>ID:</b> ${user.id} <br>
        <b>Name:</b> <input value="${user.username}" id="name-${user.id}">
        <button onclick="updateUser(${user.id})">Update</button>
        <button onclick="deleteUser(${user.id})">Delete</button>
      `;
      usersDiv.appendChild(div);
    });
  }

  async function updateUser(id) {
    const username = document.getElementById(`name-${id}`).value;
    const res = await fetch(`${API}/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username })
    });
    if (res.ok) getAllUsers();
  }

  async function deleteUser(id) {
    const res = await fetch(`${API}/${id}`, { method: 'DELETE' });
    alert(`User ${id} deleted`);
    if (res.ok) getAllUsers();
  }

  getAllUsers(); // Load on page load
</script>
</body>
</html>
